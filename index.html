<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PayRadar | Alpha Hub</title>
    <!-- Dependencies -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        :root { --accent: #fbbf24; }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #020617;
            color: #f1f5f9;
            -webkit-tap-highlight-color: transparent;
            font-size: 11px;
            overflow-x: hidden;
        }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        .gold-gradient {
            background: linear-gradient(135deg, #fbbf24 0%, #d97706 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .card-alpha {
            background: rgba(15, 23, 42, 0.7);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 0.75rem;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .card-alpha:active { transform: scale(0.98); background: rgba(15, 23, 42, 0.9); }
        .bottom-sheet {
            background: #020617;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            border-top-left-radius: 1.5rem;
            border-top-right-radius: 1.5rem;
            box-shadow: 0 -10px 50px rgba(0,0,0,0.9);
        }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .tab-btn {
            font-size: 9px;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            padding: 0.35rem 0.7rem;
            border-radius: 0.4rem;
            transition: all 0.2s;
        }
        input, textarea, select { font-size: 16px !important; }
        .compact-input {
            background: rgba(0,0,0,0.4);
            border: 1px solid rgba(255,255,255,0.05);
            padding: 0.5rem;
            border-radius: 0.5rem;
            font-size: 11px !important;
            color: white;
            width: 100%;
            outline: none;
        }
        .compact-input:focus { border-color: rgba(251, 191, 36, 0.3); }
    </style>

    <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@19.2.3",
    "react-dom/client": "https://esm.sh/react-dom@19.2.3/client",
    "@google/genai": "https://esm.sh/@google/genai@1.34.0",
    "@supabase/supabase-js": "https://esm.sh/@supabase/supabase-js@2.45.4",
    "react/": "https://esm.sh/react@^19.2.3/"
  }
}
</script>
</head>
<body>
    <div id="root"></div>

    <!-- Babel Transpiler with Module Support -->
    <script type="text/babel" data-type="module" data-presets="react">
        import React, { useState, useEffect, useMemo, useCallback } from 'react';
        import { createRoot } from 'react-dom/client';
        import { GoogleGenAI, Type } from "@google/genai";
        import { createClient } from '@supabase/supabase-js';

        // --- DATABASE CONFIG ---
        const SUPABASE_URL = 'https://uqvhjtvypgcryclepwtx.supabase.co';
        const SUPABASE_ANON_KEY = 'sb_publishable_D9DdcEhF9b7yet-1tgv27Q_yDkMkZo8';
        const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        const ADMIN_PASS = "ADMIN_2026_SECURE";

        // --- AI LOGIC ---
        const aiService = {
            async fetchNewAlpha() {
                try {
                    const ai = new GoogleGenAI({ apiKey: process.env.API_KEY });
                    const response = await ai.models.generateContent({
                        model: 'gemini-3-pro-preview',
                        contents: `Research the web for the top 5 NEWEST "paying" sites or apps in crypto/earning.
                        Required fields: name, category (Airdrop, Referral, Task), reward, creator, created_date, status (must be PAYING), description, link, guide.
                        Return only a valid JSON array.`,
                        config: {
                            tools: [{ googleSearch: {} }],
                            responseMimeType: "application/json",
                            responseSchema: {
                                type: Type.ARRAY,
                                items: {
                                    type: Type.OBJECT,
                                    properties: {
                                        name: { type: Type.STRING },
                                        category: { type: Type.STRING },
                                        reward: { type: Type.STRING },
                                        creator: { type: Type.STRING },
                                        created_date: { type: Type.STRING },
                                        status: { type: Type.STRING },
                                        guide: { type: Type.STRING },
                                        description: { type: Type.STRING },
                                        link: { type: Type.STRING }
                                    },
                                    required: ["name", "category", "reward", "link"]
                                }
                            }
                        }
                    });
                    return JSON.parse(response.text);
                } catch (e) { return null; }
            },
            async auditSite(site) {
                try {
                    const ai = new GoogleGenAI({ apiKey: process.env.API_KEY });
                    const response = await ai.models.generateContent({
                        model: 'gemini-3-pro-preview',
                        contents: `Deep audit of: "${site}". Is it currently paying? Find payout hashes or proofs from the last 48h. Verdict: LEGIT/SCAM/PENDING.`,
                        config: { tools: [{ googleSearch: {} }] }
                    });
                    const sources = response.candidates?.[0]?.groundingMetadata?.groundingChunks || [];
                    const links = sources.filter(c => c.web?.uri).map(c => `\nðŸ”— [${c.web.title}](${c.web.uri})`).join('');
                    return response.text + (links ? `\n\n**Verified Sources:**${links}` : '');
                } catch (e) { return "Audit Failed."; }
            }
        };

        // --- ADMIN VIEW ---
        const AdminTerminal = ({ onExit }) => {
            const [isAuth, setIsAuth] = useState(false);
            const [pass, setPass] = useState('');
            const [adCode, setAdCode] = useState('');
            const [geminiKey, setGeminiKey] = useState('');
            const [signals, setSignals] = useState([]);
            const [manual, setManual] = useState({ name: '', category: 'Airdrop', reward: '', link: '', description: '', guide: '' });

            useEffect(() => {
                if (isAuth) {
                    supabase.from('opportunities').select('*').order('created_at', { ascending: false }).limit(50).then(res => setSignals(res.data || []));
                    supabase.from('protocol_settings').select('ad_code, gemini_api_key').single().then(res => {
                        setAdCode(res.data?.ad_code || '');
                        setGeminiKey(res.data?.gemini_api_key || '');
                    });
                }
            }, [isAuth]);

            const saveProtocol = async () => {
                const { error } = await supabase.from('protocol_settings').upsert({ 
                    id: 1, 
                    ad_code: adCode,
                    gemini_api_key: geminiKey 
                });
                if (!error) alert("CORE PROTOCOLS SYNCED.");
            };

            const addManual = async () => {
                const { error } = await supabase.from('opportunities').insert([manual]);
                if (!error) { alert("BROADCASTED."); setManual({ name: '', category: 'Airdrop', reward: '', link: '', description: '', guide: '' }); }
            };

            const overrideLink = async (id, link) => {
                await supabase.from('opportunities').update({ link }).eq('id', id);
            };

            if (!isAuth) {
                return (
                    <div className="min-h-screen flex flex-col items-center justify-center p-6 bg-slate-950 font-mono">
                        <input type="password" value={pass} onChange={e => setPass(e.target.value)} placeholder="Passcode" className="compact-input text-center mb-4 max-w-[180px]" />
                        <button onClick={() => pass === ADMIN_PASS && setIsAuth(true)} className="bg-yellow-500 text-black px-6 py-2 rounded-lg font-black text-[10px] uppercase">Unlock Hub</button>
                    </div>
                );
            }

            return (
                <div className="p-4 space-y-6 max-w-md mx-auto pb-32 animate-in fade-in duration-300">
                    <header className="flex justify-between items-center"><h2 className="font-black gold-gradient italic">OVERWATCH</h2><button onClick={onExit} className="text-[9px] text-slate-500">EXIT</button></header>
                    
                    <section className="card-alpha p-4 space-y-3">
                        <h3 className="text-[9px] font-black text-slate-400 uppercase">Neural link (Gemini API)</h3>
                        <input 
                            type="password" 
                            value={geminiKey} 
                            onChange={e => setGeminiKey(e.target.value)} 
                            className="compact-input font-mono text-[10px]" 
                            placeholder="Gemini API Key (sk-...)" 
                        />
                        <h3 className="text-[9px] font-black text-slate-400 uppercase">Adsterra Injection</h3>
                        <textarea value={adCode} onChange={e => setAdCode(e.target.value)} className="compact-input h-24 font-mono text-[9px]" placeholder="<script>..." />
                        <button onClick={saveProtocol} className="w-full bg-white text-black py-2 rounded text-[9px] font-black uppercase">Sync Monetization & Neural Link</button>
                    </section>

                    <section className="card-alpha p-4 space-y-2">
                        <h3 className="text-[9px] font-black text-slate-400 uppercase">Publish Signal</h3>
                        <input value={manual.name} onChange={e => setManual({...manual, name: e.target.value})} placeholder="Project Name" className="compact-input" />
                        <input value={manual.link} onChange={e => setManual({...manual, link: e.target.value})} placeholder="Referral Link" className="compact-input" />
                        <button onClick={addManual} className="w-full bg-yellow-500 text-black py-2 rounded text-[9px] font-black uppercase">Broadcast</button>
                    </section>
                    <section className="space-y-2">
                        <h3 className="text-[9px] font-black text-slate-400 uppercase">Active Overrides</h3>
                        {signals.map(s => (
                            <div key={s.id} className="card-alpha p-2 flex flex-col gap-1 border-white/5">
                                <span className="text-[9px] font-black text-slate-300">{s.name}</span>
                                <input defaultValue={s.link} onBlur={e => overrideLink(s.id, e.target.value)} className="compact-input text-yellow-500 border-none bg-black/20" />
                            </div>
                        ))}
                    </section>
                </div>
            );
        };

        // --- MAIN APP ---
        const App = () => {
            const [view, setView] = useState('feed');
            const [isAdmin] = useState(window.location.search.includes('admin'));
            const [signals, setSignals] = useState([]);
            const [loading, setLoading] = useState(true);
            const [selected, setSelected] = useState(null);
            const [auditQ, setAuditQ] = useState('');
            const [auditR, setAuditR] = useState('');
            const [auditing, setAuditing] = useState(false);
            const [activeTab, setActiveTab] = useState('ALL');

            const fetchFeed = useCallback(async () => {
                const { data } = await supabase.from('opportunities').select('*').order('created_at', { ascending: false }).limit(100);
                if (data) setSignals(data);
                setLoading(false);
            }, []);

            useEffect(() => {
                const alphaRoutine = async () => {
                    const res = await aiService.fetchNewAlpha();
                    if (res && Array.isArray(res)) {
                        for (const item of res) {
                            const { data } = await supabase.from('opportunities').select('id').eq('name', item.name).maybeSingle();
                            if (!data) await supabase.from('opportunities').insert([item]);
                        }
                        fetchFeed();
                    }
                };
                alphaRoutine();
                const interval = setInterval(alphaRoutine, 3600000);
                return () => clearInterval(interval);
            }, [fetchFeed]);

            useEffect(() => {
                fetchFeed();
                const sub = supabase.channel('hub').on('postgres_changes', { event: '*', schema: 'public', table: 'opportunities' }, fetchFeed).subscribe();
                supabase.from('protocol_settings').select('ad_code').single().then(res => {
                    if (res.data?.ad_code) {
                        const d = document.createElement('div');
                        d.className = 'fixed bottom-12 left-0 right-0 z-40 text-center scale-[0.6] opacity-30 pointer-events-none';
                        d.innerHTML = res.data.ad_code;
                        document.body.appendChild(d);
                        const ss = d.getElementsByTagName('script');
                        for (let s of ss) {
                            const ns = document.createElement('script');
                            if (s.src) ns.src = s.src; else ns.textContent = s.textContent;
                            document.body.appendChild(ns);
                        }
                    }
                });
                return () => supabase.removeChannel(sub);
            }, [fetchFeed]);

            const runAudit = async () => {
                if (!auditQ) return;
                setAuditing(true); setAuditR('');
                const res = await aiService.auditSite(auditQ);
                setAuditR(res); setAuditing(false);
            };

            const filtered = useMemo(() => signals.filter(s => activeTab === 'ALL' || s.category.toUpperCase() === activeTab), [signals, activeTab]);

            if (isAdmin) return <AdminTerminal onExit={() => window.location.href = '/'} />;

            return (
                <div className="max-w-md mx-auto min-h-screen relative pb-20">
                    <nav className="fixed top-0 left-0 right-0 h-10 bg-slate-950/80 backdrop-blur-xl border-b border-white/5 px-4 flex items-center justify-between z-50 max-w-md mx-auto">
                        <div className="flex items-center gap-1.5">
                            <div className="w-5 h-5 bg-yellow-500 rounded flex items-center justify-center font-black text-[9px] text-black">PR</div>
                            <span className="font-black text-[10px] gold-gradient italic uppercase">PayRadar</span>
                        </div>
                        <div className="flex gap-4">
                            <button onClick={() => setView('feed')} className={`text-[8px] font-black uppercase ${view === 'feed' ? 'text-yellow-500' : 'text-slate-500'}`}>Alpha</button>
                            <button onClick={() => setView('audit')} className={`text-[8px] font-black uppercase ${view === 'audit' ? 'text-yellow-500' : 'text-slate-500'}`}>Audit</button>
                        </div>
                    </nav>

                    <main className="mt-12 p-3 space-y-4">
                        {view === 'feed' ? (
                            <div className="animate-in slide-in-from-bottom-2">
                                <header className="mb-4"><h1 className="text-xl font-black italic uppercase leading-none text-white">L100 <span className="gold-gradient">FEED.</span></h1></header>
                                <div className="flex gap-1 overflow-x-auto hide-scrollbar mb-4">
                                    {['ALL', 'AIRDROP', 'REFERRAL', 'TASK'].map(t => (
                                        <button key={t} onClick={() => setActiveTab(t)} className={`tab-btn whitespace-nowrap ${activeTab === t ? 'bg-yellow-500 text-black' : 'bg-slate-900 text-slate-500'}`}>{t}</button>
                                    ))}
                                </div>
                                <div className="space-y-1.5">
                                    {loading ? <div className="text-[8px] text-center p-10 font-black opacity-20 uppercase tracking-widest">Scanning Market...</div> :
                                    filtered.map(sig => (
                                        <div key={sig.id} onClick={() => setSelected(sig)} className="card-alpha p-3 flex justify-between items-center group cursor-pointer border-white/5">
                                            <div>
                                                <div className="flex items-center gap-1.5 mb-0.5">
                                                    <span className="text-[10px] font-black text-white group-hover:text-yellow-500 transition-colors uppercase italic">{sig.name}</span>
                                                    <span className="text-[6px] font-black text-green-500 bg-green-500/5 px-1 rounded border border-green-500/10">PAYING</span>
                                                </div>
                                                <span className="text-[8px] font-mono text-yellow-500/80 uppercase">{sig.reward}</span>
                                            </div>
                                            <span className="text-[8px] font-bold text-slate-500 uppercase">Intel â†’</span>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        ) : (
                            <div className="animate-in slide-in-from-right-2">
                                <header className="mb-6"><h1 className="text-xl font-black italic uppercase text-white">NEURAL <span className="gold-gradient">AUDIT.</span></h1></header>
                                <div className="card-alpha p-4 space-y-3">
                                    <input value={auditQ} onChange={e => setAuditQ(e.target.value)} onKeyDown={e => e.key === 'Enter' && runAudit()} placeholder="Site or URL..." className="compact-input" />
                                    <button onClick={runAudit} disabled={auditing} className="w-full bg-white text-black font-black py-3 rounded-lg uppercase text-[9px]">{auditing ? 'VETTING...' : 'Audit Signal'}</button>
                                </div>
                                {auditR && <div className="mt-4 bg-slate-900/40 p-4 rounded-xl border border-white/5 text-[9px] font-mono leading-relaxed text-slate-300 whitespace-pre-wrap">{auditR}</div>}
                            </div>
                        )}
                    </main>

                    {selected && (
                        <div className="fixed inset-0 z-[100] flex items-end justify-center bg-black/70 backdrop-blur-sm" onClick={() => setSelected(null)}>
                            <div className="w-full max-w-md bottom-sheet p-5 space-y-4 animate-in slide-in-from-bottom-10" onClick={e => e.stopPropagation()}>
                                <div className="flex justify-between items-start">
                                    <h2 className="text-2xl font-black text-white italic uppercase tracking-tighter leading-none">{selected.name}</h2>
                                    <button onClick={() => setSelected(null)} className="text-2xl text-slate-500">Ã—</button>
                                </div>
                                <div className="space-y-4 overflow-y-auto max-h-[60vh] hide-scrollbar pb-6 text-[10px]">
                                    <div className="grid grid-cols-2 gap-2">
                                        <div className="bg-white/5 p-2 rounded border border-white/5"><span className="text-slate-500 block mb-1">Yield</span><span className="text-yellow-500 font-black">{selected.reward}</span></div>
                                        <div className="bg-white/5 p-2 rounded border border-white/5"><span className="text-slate-500 block mb-1">Creator</span><span className="text-cyan-400 font-black uppercase">{selected.creator || 'Vetted'}</span></div>
                                    </div>
                                    <div className="bg-slate-900/50 p-3 rounded-xl border border-white/5"><p className="text-slate-300 font-medium">{selected.description}</p></div>
                                    {selected.guide && <div className="bg-yellow-500/5 p-3 rounded-xl border border-yellow-500/10"><div className="text-slate-400 font-medium whitespace-pre-wrap">{selected.guide}</div></div>}
                                    <div className="pt-4"><a href={selected.link} target="_blank" className="block w-full text-center py-4 bg-white text-black font-black rounded-xl uppercase shadow-2xl">Claim Alpha</a></div>
                                </div>
                            </div>
                        </div>
                    )}

                    <footer className="fixed bottom-0 left-0 right-0 h-8 border-t border-white/5 bg-slate-950 flex items-center justify-center z-40 max-w-md mx-auto">
                        <p className="text-[7px] text-slate-800 font-black uppercase tracking-[0.5em]">Â© 2026 PayRadar â€¢ <a href="?admin=true">Terminal</a></p>
                    </footer>
                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
